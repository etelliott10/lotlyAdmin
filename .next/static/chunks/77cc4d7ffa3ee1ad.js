(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9165,e=>{"use strict";let a="http://localhost:8000";function t(e){(401===e||403===e)&&(sessionStorage.removeItem("lotly_admin_access_token"),sessionStorage.removeItem("lotly_access_token"),window.location.pathname.startsWith("/login")||(window.location.href="/login"))}async function l(e){let l=await fetch(`${a}${e}`,{method:"GET",credentials:"include"});l.ok||t(l.status);let i=await l.text(),d=i?JSON.parse(i):null;if(!l.ok)throw Error(d&&"detail"in d&&d.detail||`Request failed (${l.status})`);return d}async function i(e,l){let i=await fetch(`${a}${e}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)});i.ok||t(i.status);let d=await i.text(),s=d?JSON.parse(d):null;if(!i.ok)throw Error(s&&"detail"in s&&s.detail||`Request failed (${i.status})`);return s}async function d(e,l){let i=await fetch(`${a}${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)});i.ok||t(i.status);let d=await i.text(),s=d?JSON.parse(d):null;if(!i.ok)throw Error(s&&"detail"in s&&s.detail||`Request failed (${i.status})`);return s}e.s(["apiBaseUrl",0,a,"apiGet",()=>l,"apiPatch",()=>d,"apiPost",()=>i])},58595,e=>{e.v({actionButton:"section-module__zQf7-W__actionButton",actionRow:"section-module__zQf7-W__actionRow",adminList:"section-module__zQf7-W__adminList",adminRow:"section-module__zQf7-W__adminRow",header:"section-module__zQf7-W__header",inlineButton:"section-module__zQf7-W__inlineButton",modal:"section-module__zQf7-W__modal",modalActions:"section-module__zQf7-W__modalActions",modalBackdrop:"section-module__zQf7-W__modalBackdrop",modalDivider:"section-module__zQf7-W__modalDivider",modalForm:"section-module__zQf7-W__modalForm",modalGrid:"section-module__zQf7-W__modalGrid",modalHeader:"section-module__zQf7-W__modalHeader",modalInput:"section-module__zQf7-W__modalInput",modalLabel:"section-module__zQf7-W__modalLabel",modalPrimary:"section-module__zQf7-W__modalPrimary",modalSecondary:"section-module__zQf7-W__modalSecondary",modalSubtitle:"section-module__zQf7-W__modalSubtitle",modalTextarea:"section-module__zQf7-W__modalTextarea",page:"section-module__zQf7-W__page",panel:"section-module__zQf7-W__panel",panelBody:"section-module__zQf7-W__panelBody",panelGrid:"section-module__zQf7-W__panelGrid",panelTitle:"section-module__zQf7-W__panelTitle",passwordBox:"section-module__zQf7-W__passwordBox",resetButton:"section-module__zQf7-W__resetButton",subtitle:"section-module__zQf7-W__subtitle",title:"section-module__zQf7-W__title"})},59041,e=>{"use strict";var a=e.i(43476),t=e.i(71645),l=e.i(9165),i=e.i(58595);let d="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%",s=[{title:"New account setup",body:"Provision a new tenant, assign plan, and configure billing owner."},{title:"Account status",body:"Activate or deactivate accounts based on payment status or policy."},{title:"Site inventory",body:"Track total sites per account and enforce plan limits."}];function n(){let[e,n]=(0,t.useState)(s),[o,r]=(0,t.useState)([]),[c,m]=(0,t.useState)({}),[u,_]=(0,t.useState)({}),[p,f]=(0,t.useState)({}),[h,x]=(0,t.useState)(null),[j,y]=(0,t.useState)(""),[N,v]=(0,t.useState)(""),[b,g]=(0,t.useState)(null),[w,S]=(0,t.useState)(""),[A,C]=(0,t.useState)("form"),[B,P]=(0,t.useState)(""),[Q,W]=(0,t.useState)({}),[z,$]=(0,t.useState)(!1),[k,T]=(0,t.useState)(null),[L,I]=(0,t.useState)(!1),[E,R]=(0,t.useState)("form"),[G,D]=(0,t.useState)(""),[q,F]=(0,t.useState)({name:"",legal_name:"",tax_id:"",billing_email:"",status:"active",admin_first_name:"",admin_last_name:"",admin_email:""}),O=(0,t.useMemo)(()=>{let e=o.length;return{totalAccounts:e,activeAccounts:o.filter(e=>(e.status??"active")==="active").length,totalAdmins:Object.values(c).reduce((e,a)=>e+a,0)}},[o,c]);(0,t.useEffect)(()=>{let e=!0;return Promise.all([(0,l.apiGet)("/crud/top_hierarchy"),(0,l.apiGet)("/crud/admin_list"),(0,l.apiGet)("/crud/admin"),(0,l.apiGet)("/crud/user"),(0,l.apiGet)("/crud/entity_list"),(0,l.apiGet)("/crud/entities")]).then(([a,t,l,i,d,s])=>{if(!e)return;r(a);let n=new Map(t.map(e=>[e.id,e.top_hierarchy_id])),o=new Map(i.map(e=>[e.id,e.email??""])),c=new Map(d.map(e=>[e.id,e.top_hierarchy_id])),u={},p={},h={};l.forEach(e=>{let a=n.get(e.admin_list_id);if(!a)return;u[a]=(u[a]??0)+1;let t=o.get(e.user_id);t&&(p[a]=[...p[a]??[],t]);let l=i.find(a=>a.id===e.user_id);l&&(h[a]=[...h[a]??[],l])}),m(u),_(p),f(h);let x={};s.forEach(e=>{let a=c.get(e.entity_list_id);if(!a)return;let t=Number(e.total_sites??0);x[a]=(x[a]??0)+(Number.isNaN(t)?0:t)}),W(x)}).catch(()=>{}),()=>{e=!1}},[]),(0,t.useEffect)(()=>{n(e=>e.map(e=>"New account setup"===e.title?{...e,body:`${O.totalAccounts} total accounts in the portfolio.`}:"Account status"===e.title?{...e,body:`${O.activeAccounts} active accounts \xb7 ${O.totalAccounts-O.activeAccounts} inactive.`}:"Site inventory"===e.title?{...e,body:`${O.totalAdmins} admins assigned across accounts.`}:e))},[O]);let U=(e=12)=>{let a=new Uint32Array(e);return window.crypto.getRandomValues(a),Array.from(a,e=>d[e%d.length]).join("")},H=async()=>{if(!q.name.trim())return void T("Account name is required.");if(!q.admin_email.trim())return void T("Admin email is required.");$(!0),T(null);let e=new Date().toISOString(),a=U();try{let t=await (0,l.apiPost)("/crud/top_hierarchy",{name:q.name.trim(),legal_name:q.legal_name.trim()||null,tax_id:q.tax_id.trim()||null,billing_email:q.billing_email.trim()||null,status:q.status||"active",created_at:e,updated_at:e}),i=await (0,l.apiPost)("/crud/admin_list",{top_hierarchy_id:t.id,created_at:e,updated_at:e}),d=await (0,l.apiPost)("/crud/employee_list",{top_hierarchy_id:t.id,created_at:e,updated_at:e}),s=await (0,l.apiPost)("/crud/entity_list",{top_hierarchy_id:t.id,created_at:e,updated_at:e}),n=await (0,l.apiPost)("/crud/resident_list",{top_hierarchy_id:t.id,created_at:e,updated_at:e}),o=await (0,l.apiPost)("/crud/website_list",{top_hierarchy_id:t.id,created_at:e,updated_at:e});await (0,l.apiPatch)(`/crud/top_hierarchy/${t.id}`,{admin_list_id:i.id,employee_list_id:d.id,entity_list_id:s.id,resident_list_id:n.id,website_list_id:o.id,updated_at:e});let c=q.admin_email.trim().toLowerCase(),u=q.admin_first_name.trim()||null,p=q.admin_last_name.trim()||null,h=await (0,l.apiPost)("/admin/users/create",{email:c,password:a,admin_list_id:i.id,first_name:u,last_name:p,portal:"employee"});r(e=>[{...t,admin_list_id:i.id,employee_list_id:d.id,entity_list_id:s.id,resident_list_id:n.id,website_list_id:o.id},...e]),m(e=>({...e,[t.id]:(e[t.id]??0)+1})),_(e=>({...e,[t.id]:[...e[t.id]??[],c]})),f(e=>({...e,[t.id]:[...e[t.id]??[],{id:h.id,email:c,first_name:u,last_name:p}]})),D(a),R("done")}catch(e){T(e instanceof Error?e.message:"Unable to create account.")}finally{$(!1)}},J=()=>{x(null),y(""),v("")},M=()=>{g(null),S(""),P(""),C("form")},K=async()=>{if(!b)return;if(!w.trim())return void T("Admin email is required.");let e=b.account;if(!e.admin_list_id)return void T("This account does not have an admin list yet.");T(null);let a=w.trim().toLowerCase(),t=U();try{let i=await (0,l.apiPost)("/admin/users/create",{email:a,password:t,admin_list_id:e.admin_list_id,portal:"employee"});m(a=>({...a,[e.id]:(a[e.id]??0)+1})),_(t=>({...t,[e.id]:[...t[e.id]??[],a]})),f(a=>({...a,[e.id]:[...a[e.id]??[],i]})),P(t),C("done")}catch(e){T(e instanceof Error?e.message:"Unable to add admin.")}};return(0,a.jsxs)("section",{className:i.default.page,children:[(0,a.jsxs)("header",{className:i.default.header,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:i.default.title,children:"Account Control"}),(0,a.jsx)("p",{className:i.default.subtitle,children:"Create new accounts, assign billing controls, and manage active status across the Lotly network."})]}),(0,a.jsxs)("div",{className:i.default.actionRow,children:[(0,a.jsx)("button",{className:i.default.actionButton,type:"button",onClick:()=>{T(null),R("form"),D(""),I(!0)},children:"Create account"}),(0,a.jsx)("button",{className:i.default.actionButton,type:"button",onClick:()=>{let e=window.prompt("Enter the account ID or exact account name to suspend:");if(!e)return;let a=e.trim().toLowerCase(),t=o.find(e=>String(e.id)===a||!!e.name&&e.name.toLowerCase()===a);if(!t)return void T("Account not found. Please use a valid ID or name.");if(window.prompt(`Type SUSPEND ${t.id} to confirm pausing this account.`)!==`SUSPEND ${t.id}`)return void alert("Suspension cancelled.");T(null);let i=new Date().toISOString();(0,l.apiPatch)(`/crud/top_hierarchy/${t.id}`,{status:"suspended",updated_at:i}).then(e=>{r(a=>a.map(a=>a.id===t.id?{...a,...e}:a))}).catch(e=>{T(e instanceof Error?e.message:"Unable to suspend account.")})},children:"Suspend account"})]})]}),k&&(0,a.jsx)("p",{className:i.default.subtitle,children:k}),L&&(0,a.jsx)("div",{className:i.default.modalBackdrop,role:"presentation",children:(0,a.jsxs)("div",{className:i.default.modal,role:"dialog","aria-modal":"true",children:[(0,a.jsxs)("header",{className:i.default.modalHeader,children:[(0,a.jsx)("h3",{children:"Create account"}),(0,a.jsx)("p",{className:i.default.modalSubtitle,children:"Enter top hierarchy details for the new account."})]}),"form"===E?(0,a.jsxs)("form",{className:i.default.modalForm,onSubmit:e=>{e.preventDefault(),H()},children:[(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Account name",(0,a.jsx)("input",{className:i.default.modalInput,value:q.name,onChange:e=>F(a=>({...a,name:e.target.value})),placeholder:"Sunrise Communities",required:!0})]}),(0,a.jsxs)("div",{className:i.default.modalGrid,children:[(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Legal name",(0,a.jsx)("input",{className:i.default.modalInput,value:q.legal_name,onChange:e=>F(a=>({...a,legal_name:e.target.value})),placeholder:"Sunrise Holdings LLC"})]}),(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Tax ID",(0,a.jsx)("input",{className:i.default.modalInput,value:q.tax_id,onChange:e=>F(a=>({...a,tax_id:e.target.value})),placeholder:"12-3456789"})]})]}),(0,a.jsxs)("div",{className:i.default.modalGrid,children:[(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Billing email",(0,a.jsx)("input",{className:i.default.modalInput,type:"email",value:q.billing_email,onChange:e=>F(a=>({...a,billing_email:e.target.value})),placeholder:"billing@sunrise.com"})]}),(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Status",(0,a.jsxs)("select",{className:i.default.modalInput,value:q.status,onChange:e=>F(a=>({...a,status:e.target.value})),children:[(0,a.jsx)("option",{value:"active",children:"Active"}),(0,a.jsx)("option",{value:"inactive",children:"Inactive"}),(0,a.jsx)("option",{value:"pending",children:"Pending"})]})]})]}),(0,a.jsx)("div",{className:i.default.modalDivider,children:"Admin contact"}),(0,a.jsxs)("div",{className:i.default.modalGrid,children:[(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Admin first name",(0,a.jsx)("input",{className:i.default.modalInput,value:q.admin_first_name,onChange:e=>F(a=>({...a,admin_first_name:e.target.value})),placeholder:"Alex"})]}),(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Admin last name",(0,a.jsx)("input",{className:i.default.modalInput,value:q.admin_last_name,onChange:e=>F(a=>({...a,admin_last_name:e.target.value})),placeholder:"Morgan"})]})]}),(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Admin email",(0,a.jsx)("input",{className:i.default.modalInput,type:"email",value:q.admin_email,onChange:e=>F(a=>({...a,admin_email:e.target.value})),placeholder:"admin@sunrise.com",required:!0})]}),(0,a.jsxs)("div",{className:i.default.modalActions,children:[(0,a.jsx)("button",{className:i.default.modalSecondary,type:"button",onClick:()=>{I(!1),T(null),R("form"),D("")},children:"Cancel"}),(0,a.jsx)("button",{className:i.default.modalPrimary,type:"submit",disabled:z,children:z?"Creating...":"Create account"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:i.default.modalForm,children:[(0,a.jsx)("p",{className:i.default.panelBody,children:"Account created. Save the admin credentials below."}),(0,a.jsxs)("p",{className:i.default.panelBody,children:["Admin email: ",q.admin_email.trim()]}),(0,a.jsx)("div",{className:i.default.passwordBox,children:G})]}),(0,a.jsx)("div",{className:i.default.modalActions,children:(0,a.jsx)("button",{className:i.default.modalPrimary,type:"button",onClick:()=>{I(!1),R("form"),D(""),F({name:"",legal_name:"",tax_id:"",billing_email:"",status:"active",admin_first_name:"",admin_last_name:"",admin_email:""})},children:"Done"})})]})]})}),(0,a.jsx)("div",{className:i.default.panelGrid,children:e.map(e=>(0,a.jsxs)("div",{className:i.default.panel,children:[(0,a.jsx)("p",{className:i.default.panelTitle,children:e.title}),(0,a.jsx)("p",{className:i.default.panelBody,children:e.body})]},e.title))}),o.length>0&&(0,a.jsx)("div",{className:i.default.panelGrid,children:o.map(e=>(0,a.jsxs)("div",{className:i.default.panel,children:[(0,a.jsx)("p",{className:i.default.panelTitle,children:e.name??`Account ${e.id}`}),(0,a.jsxs)("p",{className:i.default.panelBody,children:["Legal name: ",e.legal_name??"—"]}),(0,a.jsxs)("p",{className:i.default.panelBody,children:["Tax ID: ",e.tax_id??"—"]}),(0,a.jsxs)("p",{className:i.default.panelBody,children:["Site inventory: ",Q[e.id]??0]}),(0,a.jsxs)("p",{className:i.default.panelBody,children:["Admins: ",c[e.id]??0]}),(0,a.jsx)("button",{className:i.default.inlineButton,type:"button",onClick:()=>{T(null),S(""),P(""),C("form"),g({account:e})},children:"Add admin"}),p[e.id]?.length?(0,a.jsx)("div",{className:i.default.adminList,children:p[e.id].map(t=>(0,a.jsxs)("div",{className:i.default.adminRow,children:[(0,a.jsx)("span",{className:i.default.panelBody,children:t.email??`Admin ${t.id}`}),(0,a.jsx)("button",{className:i.default.resetButton,type:"button",onClick:()=>{y(""),v(""),x({accountId:e.id,accountName:e.name??`Account ${e.id}`,admin:t,step:"verify"})},children:"Reset password"})]},t.id))}):(0,a.jsx)("p",{className:i.default.panelBody,children:"No admins assigned."})]},e.id))}),h&&(0,a.jsx)("div",{className:i.default.modalBackdrop,role:"presentation",children:(0,a.jsxs)("div",{className:i.default.modal,role:"dialog","aria-modal":"true",children:[(0,a.jsxs)("header",{className:i.default.modalHeader,children:[(0,a.jsx)("h3",{children:"Reset admin password"}),(0,a.jsxs)("p",{className:i.default.modalSubtitle,children:["Account: ",h.accountName]})]}),(0,a.jsxs)("div",{className:i.default.modalForm,children:["verify"===h.step&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:i.default.panelBody,children:["Admin: ",h.admin.email??`Admin ${h.admin.id}`]}),(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Type ",(0,a.jsxs)("strong",{children:["RESET ",h.admin.id]})," to continue.",(0,a.jsx)("input",{className:i.default.modalInput,value:j,onChange:e=>y(e.target.value),placeholder:`RESET ${h.admin.id}`})]})]}),"reason"===h.step&&(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Reason for reset",(0,a.jsx)("textarea",{className:`${i.default.modalInput} ${i.default.modalTextarea}`,value:N,onChange:e=>v(e.target.value),placeholder:"User requested reset after failed login attempts.",rows:3})]}),"done"===h.step&&(0,a.jsx)("p",{className:i.default.panelBody,children:"Confirmation complete. This reset will be queued with the reason provided."})]}),(0,a.jsxs)("div",{className:i.default.modalActions,children:[(0,a.jsx)("button",{className:i.default.modalSecondary,type:"button",onClick:J,children:"Cancel"}),"done"!==h.step?(0,a.jsx)("button",{className:i.default.modalPrimary,type:"button",onClick:()=>{if(h){if("verify"===h.step){let e=`RESET ${h.admin.id}`;return j.trim()!==e?void T("Type the exact confirmation phrase to continue."):(T(null),void x({...h,step:"reason"}))}if("reason"===h.step){if(!N.trim())return void T("Please add a reason for the reset.");T(null),x({...h,step:"done"})}}},children:"Continue"}):(0,a.jsx)("button",{className:i.default.modalPrimary,type:"button",onClick:()=>{h&&(J(),alert(`Password reset queued for ${h.admin.email??"admin user"}.
Reason: ${N}`))},children:"Queue reset"})]})]})}),b&&(0,a.jsx)("div",{className:i.default.modalBackdrop,role:"presentation",children:(0,a.jsxs)("div",{className:i.default.modal,role:"dialog","aria-modal":"true",children:[(0,a.jsxs)("header",{className:i.default.modalHeader,children:[(0,a.jsx)("h3",{children:"Add admin"}),(0,a.jsxs)("p",{className:i.default.modalSubtitle,children:["Account: ",b.account.name??`Account ${b.account.id}`]})]}),"form"===A?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:i.default.modalForm,children:(0,a.jsxs)("label",{className:i.default.modalLabel,children:["Admin email",(0,a.jsx)("input",{className:i.default.modalInput,type:"email",value:w,onChange:e=>S(e.target.value),placeholder:"admin@account.com"})]})}),(0,a.jsxs)("div",{className:i.default.modalActions,children:[(0,a.jsx)("button",{className:i.default.modalSecondary,type:"button",onClick:M,children:"Cancel"}),(0,a.jsx)("button",{className:i.default.modalPrimary,type:"button",onClick:K,children:"Add admin"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:i.default.modalForm,children:[(0,a.jsx)("p",{className:i.default.panelBody,children:"Admin added. Save the temporary password below."}),(0,a.jsxs)("p",{className:i.default.panelBody,children:["Admin email: ",w.trim()]}),(0,a.jsx)("div",{className:i.default.passwordBox,children:B})]}),(0,a.jsx)("div",{className:i.default.modalActions,children:(0,a.jsx)("button",{className:i.default.modalPrimary,type:"button",onClick:M,children:"Done"})})]})]})})]})}e.s(["default",()=>n])}]);