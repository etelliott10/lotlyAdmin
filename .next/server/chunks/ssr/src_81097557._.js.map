{"version":3,"sources":["../../../../src/lib/api.ts","turbopack:///[project]/src/app/section.module.css [app-ssr] (css module)","../../../../src/app/users/page.tsx"],"sourcesContent":["export const apiBaseUrl =\n  process.env.NEXT_PUBLIC_API_BASE ?? \"http://localhost:8000\";\n\nfunction handleAuthFailure(status: number) {\n  if (typeof window === \"undefined\") return;\n  if (status !== 401 && status !== 403) return;\n  sessionStorage.removeItem(\"lotly_admin_access_token\");\n  sessionStorage.removeItem(\"lotly_access_token\");\n  if (!window.location.pathname.startsWith(\"/login\")) {\n    window.location.href = \"/login\";\n  }\n}\n\nexport async function apiGet<TResponse>(path: string): Promise<TResponse> {\n  const response = await fetch(`${apiBaseUrl}${path}`, {\n    method: \"GET\",\n    credentials: \"include\",\n  });\n\n  if (!response.ok) {\n    handleAuthFailure(response.status);\n  }\n\n  const text = await response.text();\n  const data = text ? (JSON.parse(text) as TResponse & { detail?: string }) : null;\n\n  if (!response.ok) {\n    const message =\n      (data && \"detail\" in data && data.detail) ||\n      `Request failed (${response.status})`;\n    throw new Error(message);\n  }\n\n  return data as TResponse;\n}\n\nexport async function apiPost<TResponse>(\n  path: string,\n  payload: Record<string, unknown>,\n): Promise<TResponse> {\n  const response = await fetch(`${apiBaseUrl}${path}`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    credentials: \"include\",\n    body: JSON.stringify(payload),\n  });\n\n  if (!response.ok) {\n    handleAuthFailure(response.status);\n  }\n\n  const text = await response.text();\n  const data = text ? (JSON.parse(text) as TResponse & { detail?: string }) : null;\n\n  if (!response.ok) {\n    const message =\n      (data && \"detail\" in data && data.detail) ||\n      `Request failed (${response.status})`;\n    throw new Error(message);\n  }\n\n  return data as TResponse;\n}\n\nexport async function apiPatch<TResponse>(\n  path: string,\n  payload: Record<string, unknown>,\n): Promise<TResponse> {\n  const response = await fetch(`${apiBaseUrl}${path}`, {\n    method: \"PATCH\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    credentials: \"include\",\n    body: JSON.stringify(payload),\n  });\n\n  if (!response.ok) {\n    handleAuthFailure(response.status);\n  }\n\n  const text = await response.text();\n  const data = text ? (JSON.parse(text) as TResponse & { detail?: string }) : null;\n\n  if (!response.ok) {\n    const message =\n      (data && \"detail\" in data && data.detail) ||\n      `Request failed (${response.status})`;\n    throw new Error(message);\n  }\n\n  return data as TResponse;\n}\n","__turbopack_context__.v({\n  \"actionButton\": \"section-module__zQf7-W__actionButton\",\n  \"actionRow\": \"section-module__zQf7-W__actionRow\",\n  \"adminList\": \"section-module__zQf7-W__adminList\",\n  \"adminRow\": \"section-module__zQf7-W__adminRow\",\n  \"header\": \"section-module__zQf7-W__header\",\n  \"inlineButton\": \"section-module__zQf7-W__inlineButton\",\n  \"modal\": \"section-module__zQf7-W__modal\",\n  \"modalActions\": \"section-module__zQf7-W__modalActions\",\n  \"modalBackdrop\": \"section-module__zQf7-W__modalBackdrop\",\n  \"modalDivider\": \"section-module__zQf7-W__modalDivider\",\n  \"modalForm\": \"section-module__zQf7-W__modalForm\",\n  \"modalGrid\": \"section-module__zQf7-W__modalGrid\",\n  \"modalHeader\": \"section-module__zQf7-W__modalHeader\",\n  \"modalInput\": \"section-module__zQf7-W__modalInput\",\n  \"modalLabel\": \"section-module__zQf7-W__modalLabel\",\n  \"modalPrimary\": \"section-module__zQf7-W__modalPrimary\",\n  \"modalSecondary\": \"section-module__zQf7-W__modalSecondary\",\n  \"modalSubtitle\": \"section-module__zQf7-W__modalSubtitle\",\n  \"modalTextarea\": \"section-module__zQf7-W__modalTextarea\",\n  \"page\": \"section-module__zQf7-W__page\",\n  \"panel\": \"section-module__zQf7-W__panel\",\n  \"panelBody\": \"section-module__zQf7-W__panelBody\",\n  \"panelGrid\": \"section-module__zQf7-W__panelGrid\",\n  \"panelTitle\": \"section-module__zQf7-W__panelTitle\",\n  \"passwordBox\": \"section-module__zQf7-W__passwordBox\",\n  \"resetButton\": \"section-module__zQf7-W__resetButton\",\n  \"subtitle\": \"section-module__zQf7-W__subtitle\",\n  \"title\": \"section-module__zQf7-W__title\",\n});\n","\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { apiGet } from \"@/lib/api\";\nimport styles from \"../section.module.css\";\n\ntype LotlyAdmin = {\n  id: number;\n  user_id: number;\n  first_name?: string | null;\n  last_name?: string | null;\n  title?: string | null;\n  status?: string | null;\n};\n\ntype User = { id: number; email?: string | null };\n\nexport default function UsersPage() {\n  const [lotlyAdmins, setLotlyAdmins] = useState<LotlyAdmin[]>([]);\n  const [adminEmails, setAdminEmails] = useState<Record<number, string>>({});\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    let isMounted = true;\n    Promise.all([\n      apiGet<LotlyAdmin[]>(\"/crud/lotly_admin\"),\n      apiGet<User[]>(\"/crud/user\"),\n    ])\n      .then(([lotlyAdmins, users]) => {\n        if (!isMounted) return;\n        const emailMap = new Map(users.map((row) => [row.id, row.email ?? \"\"]));\n        setAdminEmails(Object.fromEntries(emailMap.entries()));\n        setLotlyAdmins(lotlyAdmins);\n      })\n      .catch((err) => {\n        if (!isMounted) return;\n        setError(err instanceof Error ? err.message : \"Unable to load Lotly admins.\");\n      });\n    return () => {\n      isMounted = false;\n    };\n  }, []);\n\n  return (\n    <section className={styles.page}>\n      <header className={styles.header}>\n        <div>\n          <h2 className={styles.title}>Users & Access</h2>\n          <p className={styles.subtitle}>\n            Control admin credentials, roles, and critical access policies across\n            every Lotly tenant.\n          </p>\n        </div>\n        <div className={styles.actionRow}>\n          <button className={styles.actionButton} type=\"button\">\n            Invite admin\n          </button>\n          <button className={styles.actionButton} type=\"button\">\n            Reset password\n          </button>\n          <button className={styles.actionButton} type=\"button\">\n            Export access log\n          </button>\n        </div>\n      </header>\n      {error && <p className={styles.subtitle}>{error}</p>}\n      {lotlyAdmins.length > 0 && (\n        <div className={styles.panelGrid}>\n          {lotlyAdmins.map((admin) => (\n            <div key={admin.id} className={styles.panel}>\n              <p className={styles.panelTitle}>\n                {admin.first_name || admin.last_name\n                  ? `${admin.first_name ?? \"\"} ${admin.last_name ?? \"\"}`.trim()\n                  : \"Lotly Admin\"}\n              </p>\n              <p className={styles.panelBody}>\n                {adminEmails[admin.user_id] ?? \"No email\"}\n              </p>\n              <p className={styles.panelBody}>Title: {admin.title ?? \"—\"}</p>\n              <p className={styles.panelBody}>Status: {admin.status ?? \"—\"}</p>\n            </div>\n          ))}\n        </div>\n      )}\n    </section>\n  );\n}\n"],"names":[],"mappings":"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"}