module.exports=[13734,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(19032),e=a.i(48311);let f="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%",g=[{title:"New account setup",body:"Provision a new tenant, assign plan, and configure billing owner."},{title:"Account status",body:"Activate or deactivate accounts based on payment status or policy."},{title:"Site inventory",body:"Track total sites per account and enforce plan limits."}];function h(){let[a,h]=(0,c.useState)(g),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)({}),[m,n]=(0,c.useState)({}),[o,p]=(0,c.useState)({}),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)("form"),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)({}),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)("form"),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)({name:"",legal_name:"",tax_id:"",billing_email:"",status:"active",admin_first_name:"",admin_last_name:"",admin_email:""}),S=(0,c.useMemo)(()=>{let a=i.length;return{totalAccounts:a,activeAccounts:i.filter(a=>(a.status??"active")==="active").length,totalAdmins:Object.values(k).reduce((a,b)=>a+b,0)}},[i,k]);(0,c.useEffect)(()=>{let a=!0;return Promise.all([(0,d.apiGet)("/crud/top_hierarchy"),(0,d.apiGet)("/crud/admin_list"),(0,d.apiGet)("/crud/admin"),(0,d.apiGet)("/crud/user"),(0,d.apiGet)("/crud/entity_list"),(0,d.apiGet)("/crud/entities")]).then(([b,c,d,e,f,g])=>{if(!a)return;j(b);let h=new Map(c.map(a=>[a.id,a.top_hierarchy_id])),i=new Map(e.map(a=>[a.id,a.email??""])),k=new Map(f.map(a=>[a.id,a.top_hierarchy_id])),m={},o={},q={};d.forEach(a=>{let b=h.get(a.admin_list_id);if(!b)return;m[b]=(m[b]??0)+1;let c=i.get(a.user_id);c&&(o[b]=[...o[b]??[],c]);let d=e.find(b=>b.id===a.user_id);d&&(q[b]=[...q[b]??[],d])}),l(m),n(o),p(q);let r={};g.forEach(a=>{let b=k.get(a.entity_list_id);if(!b)return;let c=Number(a.total_sites??0);r[b]=(r[b]??0)+(Number.isNaN(c)?0:c)}),F(r)}).catch(()=>{}),()=>{a=!1}},[]),(0,c.useEffect)(()=>{h(a=>a.map(a=>"New account setup"===a.title?{...a,body:`${S.totalAccounts} total accounts in the portfolio.`}:"Account status"===a.title?{...a,body:`${S.activeAccounts} active accounts \xb7 ${S.totalAccounts-S.activeAccounts} inactive.`}:"Site inventory"===a.title?{...a,body:`${S.totalAdmins} admins assigned across accounts.`}:a))},[S]);let T=(a=12)=>{let b=new Uint32Array(a);return window.crypto.getRandomValues(b),Array.from(b,a=>f[a%f.length]).join("")},U=async()=>{if(!Q.name.trim())return void J("Account name is required.");if(!Q.admin_email.trim())return void J("Admin email is required.");H(!0),J(null);let a=new Date().toISOString(),b=T();try{let c=await (0,d.apiPost)("/crud/top_hierarchy",{name:Q.name.trim(),legal_name:Q.legal_name.trim()||null,tax_id:Q.tax_id.trim()||null,billing_email:Q.billing_email.trim()||null,status:Q.status||"active",created_at:a,updated_at:a}),e=await (0,d.apiPost)("/crud/admin_list",{top_hierarchy_id:c.id,created_at:a,updated_at:a}),f=await (0,d.apiPost)("/crud/employee_list",{top_hierarchy_id:c.id,created_at:a,updated_at:a}),g=await (0,d.apiPost)("/crud/entity_list",{top_hierarchy_id:c.id,created_at:a,updated_at:a}),h=await (0,d.apiPost)("/crud/resident_list",{top_hierarchy_id:c.id,created_at:a,updated_at:a}),i=await (0,d.apiPost)("/crud/website_list",{top_hierarchy_id:c.id,created_at:a,updated_at:a});await (0,d.apiPatch)(`/crud/top_hierarchy/${c.id}`,{admin_list_id:e.id,employee_list_id:f.id,entity_list_id:g.id,resident_list_id:h.id,website_list_id:i.id,updated_at:a});let k=Q.admin_email.trim().toLowerCase(),m=Q.admin_first_name.trim()||null,o=Q.admin_last_name.trim()||null,q=await (0,d.apiPost)("/admin/users/create",{email:k,password:b,admin_list_id:e.id,first_name:m,last_name:o,portal:"employee"});j(a=>[{...c,admin_list_id:e.id,employee_list_id:f.id,entity_list_id:g.id,resident_list_id:h.id,website_list_id:i.id},...a]),l(a=>({...a,[c.id]:(a[c.id]??0)+1})),n(a=>({...a,[c.id]:[...a[c.id]??[],k]})),p(a=>({...a,[c.id]:[...a[c.id]??[],{id:q.id,email:k,first_name:m,last_name:o}]})),P(b),N("done")}catch(a){J(a instanceof Error?a.message:"Unable to create account.")}finally{H(!1)}},V=()=>{r(null),t(""),v("")},W=()=>{x(null),z(""),D(""),B("form")},X=async()=>{if(!w)return;if(!y.trim())return void J("Admin email is required.");let a=w.account;if(!a.admin_list_id)return void J("This account does not have an admin list yet.");J(null);let b=y.trim().toLowerCase(),c=T();try{let e=await (0,d.apiPost)("/admin/users/create",{email:b,password:c,admin_list_id:a.admin_list_id,portal:"employee"});l(b=>({...b,[a.id]:(b[a.id]??0)+1})),n(c=>({...c,[a.id]:[...c[a.id]??[],b]})),p(b=>({...b,[a.id]:[...b[a.id]??[],e]})),D(c),B("done")}catch(a){J(a instanceof Error?a.message:"Unable to add admin.")}};return(0,b.jsxs)("section",{className:e.default.page,children:[(0,b.jsxs)("header",{className:e.default.header,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:e.default.title,children:"Account Control"}),(0,b.jsx)("p",{className:e.default.subtitle,children:"Create new accounts, assign billing controls, and manage active status across the Lotly network."})]}),(0,b.jsxs)("div",{className:e.default.actionRow,children:[(0,b.jsx)("button",{className:e.default.actionButton,type:"button",onClick:()=>{J(null),N("form"),P(""),L(!0)},children:"Create account"}),(0,b.jsx)("button",{className:e.default.actionButton,type:"button",onClick:()=>{let a=window.prompt("Enter the account ID or exact account name to suspend:");if(!a)return;let b=a.trim().toLowerCase(),c=i.find(a=>String(a.id)===b||!!a.name&&a.name.toLowerCase()===b);if(!c)return void J("Account not found. Please use a valid ID or name.");if(window.prompt(`Type SUSPEND ${c.id} to confirm pausing this account.`)!==`SUSPEND ${c.id}`)return void alert("Suspension cancelled.");J(null);let e=new Date().toISOString();(0,d.apiPatch)(`/crud/top_hierarchy/${c.id}`,{status:"suspended",updated_at:e}).then(a=>{j(b=>b.map(b=>b.id===c.id?{...b,...a}:b))}).catch(a=>{J(a instanceof Error?a.message:"Unable to suspend account.")})},children:"Suspend account"})]})]}),I&&(0,b.jsx)("p",{className:e.default.subtitle,children:I}),K&&(0,b.jsx)("div",{className:e.default.modalBackdrop,role:"presentation",children:(0,b.jsxs)("div",{className:e.default.modal,role:"dialog","aria-modal":"true",children:[(0,b.jsxs)("header",{className:e.default.modalHeader,children:[(0,b.jsx)("h3",{children:"Create account"}),(0,b.jsx)("p",{className:e.default.modalSubtitle,children:"Enter top hierarchy details for the new account."})]}),"form"===M?(0,b.jsxs)("form",{className:e.default.modalForm,onSubmit:a=>{a.preventDefault(),U()},children:[(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Account name",(0,b.jsx)("input",{className:e.default.modalInput,value:Q.name,onChange:a=>R(b=>({...b,name:a.target.value})),placeholder:"Sunrise Communities",required:!0})]}),(0,b.jsxs)("div",{className:e.default.modalGrid,children:[(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Legal name",(0,b.jsx)("input",{className:e.default.modalInput,value:Q.legal_name,onChange:a=>R(b=>({...b,legal_name:a.target.value})),placeholder:"Sunrise Holdings LLC"})]}),(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Tax ID",(0,b.jsx)("input",{className:e.default.modalInput,value:Q.tax_id,onChange:a=>R(b=>({...b,tax_id:a.target.value})),placeholder:"12-3456789"})]})]}),(0,b.jsxs)("div",{className:e.default.modalGrid,children:[(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Billing email",(0,b.jsx)("input",{className:e.default.modalInput,type:"email",value:Q.billing_email,onChange:a=>R(b=>({...b,billing_email:a.target.value})),placeholder:"billing@sunrise.com"})]}),(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Status",(0,b.jsxs)("select",{className:e.default.modalInput,value:Q.status,onChange:a=>R(b=>({...b,status:a.target.value})),children:[(0,b.jsx)("option",{value:"active",children:"Active"}),(0,b.jsx)("option",{value:"inactive",children:"Inactive"}),(0,b.jsx)("option",{value:"pending",children:"Pending"})]})]})]}),(0,b.jsx)("div",{className:e.default.modalDivider,children:"Admin contact"}),(0,b.jsxs)("div",{className:e.default.modalGrid,children:[(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Admin first name",(0,b.jsx)("input",{className:e.default.modalInput,value:Q.admin_first_name,onChange:a=>R(b=>({...b,admin_first_name:a.target.value})),placeholder:"Alex"})]}),(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Admin last name",(0,b.jsx)("input",{className:e.default.modalInput,value:Q.admin_last_name,onChange:a=>R(b=>({...b,admin_last_name:a.target.value})),placeholder:"Morgan"})]})]}),(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Admin email",(0,b.jsx)("input",{className:e.default.modalInput,type:"email",value:Q.admin_email,onChange:a=>R(b=>({...b,admin_email:a.target.value})),placeholder:"admin@sunrise.com",required:!0})]}),(0,b.jsxs)("div",{className:e.default.modalActions,children:[(0,b.jsx)("button",{className:e.default.modalSecondary,type:"button",onClick:()=>{L(!1),J(null),N("form"),P("")},children:"Cancel"}),(0,b.jsx)("button",{className:e.default.modalPrimary,type:"submit",disabled:G,children:G?"Creating...":"Create account"})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:e.default.modalForm,children:[(0,b.jsx)("p",{className:e.default.panelBody,children:"Account created. Save the admin credentials below."}),(0,b.jsxs)("p",{className:e.default.panelBody,children:["Admin email: ",Q.admin_email.trim()]}),(0,b.jsx)("div",{className:e.default.passwordBox,children:O})]}),(0,b.jsx)("div",{className:e.default.modalActions,children:(0,b.jsx)("button",{className:e.default.modalPrimary,type:"button",onClick:()=>{L(!1),N("form"),P(""),R({name:"",legal_name:"",tax_id:"",billing_email:"",status:"active",admin_first_name:"",admin_last_name:"",admin_email:""})},children:"Done"})})]})]})}),(0,b.jsx)("div",{className:e.default.panelGrid,children:a.map(a=>(0,b.jsxs)("div",{className:e.default.panel,children:[(0,b.jsx)("p",{className:e.default.panelTitle,children:a.title}),(0,b.jsx)("p",{className:e.default.panelBody,children:a.body})]},a.title))}),i.length>0&&(0,b.jsx)("div",{className:e.default.panelGrid,children:i.map(a=>(0,b.jsxs)("div",{className:e.default.panel,children:[(0,b.jsx)("p",{className:e.default.panelTitle,children:a.name??`Account ${a.id}`}),(0,b.jsxs)("p",{className:e.default.panelBody,children:["Legal name: ",a.legal_name??"—"]}),(0,b.jsxs)("p",{className:e.default.panelBody,children:["Tax ID: ",a.tax_id??"—"]}),(0,b.jsxs)("p",{className:e.default.panelBody,children:["Site inventory: ",E[a.id]??0]}),(0,b.jsxs)("p",{className:e.default.panelBody,children:["Admins: ",k[a.id]??0]}),(0,b.jsx)("button",{className:e.default.inlineButton,type:"button",onClick:()=>{J(null),z(""),D(""),B("form"),x({account:a})},children:"Add admin"}),o[a.id]?.length?(0,b.jsx)("div",{className:e.default.adminList,children:o[a.id].map(c=>(0,b.jsxs)("div",{className:e.default.adminRow,children:[(0,b.jsx)("span",{className:e.default.panelBody,children:c.email??`Admin ${c.id}`}),(0,b.jsx)("button",{className:e.default.resetButton,type:"button",onClick:()=>{t(""),v(""),r({accountId:a.id,accountName:a.name??`Account ${a.id}`,admin:c,step:"verify"})},children:"Reset password"})]},c.id))}):(0,b.jsx)("p",{className:e.default.panelBody,children:"No admins assigned."})]},a.id))}),q&&(0,b.jsx)("div",{className:e.default.modalBackdrop,role:"presentation",children:(0,b.jsxs)("div",{className:e.default.modal,role:"dialog","aria-modal":"true",children:[(0,b.jsxs)("header",{className:e.default.modalHeader,children:[(0,b.jsx)("h3",{children:"Reset admin password"}),(0,b.jsxs)("p",{className:e.default.modalSubtitle,children:["Account: ",q.accountName]})]}),(0,b.jsxs)("div",{className:e.default.modalForm,children:["verify"===q.step&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("p",{className:e.default.panelBody,children:["Admin: ",q.admin.email??`Admin ${q.admin.id}`]}),(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Type ",(0,b.jsxs)("strong",{children:["RESET ",q.admin.id]})," to continue.",(0,b.jsx)("input",{className:e.default.modalInput,value:s,onChange:a=>t(a.target.value),placeholder:`RESET ${q.admin.id}`})]})]}),"reason"===q.step&&(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Reason for reset",(0,b.jsx)("textarea",{className:`${e.default.modalInput} ${e.default.modalTextarea}`,value:u,onChange:a=>v(a.target.value),placeholder:"User requested reset after failed login attempts.",rows:3})]}),"done"===q.step&&(0,b.jsx)("p",{className:e.default.panelBody,children:"Confirmation complete. This reset will be queued with the reason provided."})]}),(0,b.jsxs)("div",{className:e.default.modalActions,children:[(0,b.jsx)("button",{className:e.default.modalSecondary,type:"button",onClick:V,children:"Cancel"}),"done"!==q.step?(0,b.jsx)("button",{className:e.default.modalPrimary,type:"button",onClick:()=>{if(q){if("verify"===q.step){let a=`RESET ${q.admin.id}`;return s.trim()!==a?void J("Type the exact confirmation phrase to continue."):(J(null),void r({...q,step:"reason"}))}if("reason"===q.step){if(!u.trim())return void J("Please add a reason for the reset.");J(null),r({...q,step:"done"})}}},children:"Continue"}):(0,b.jsx)("button",{className:e.default.modalPrimary,type:"button",onClick:()=>{q&&(V(),alert(`Password reset queued for ${q.admin.email??"admin user"}.
Reason: ${u}`))},children:"Queue reset"})]})]})}),w&&(0,b.jsx)("div",{className:e.default.modalBackdrop,role:"presentation",children:(0,b.jsxs)("div",{className:e.default.modal,role:"dialog","aria-modal":"true",children:[(0,b.jsxs)("header",{className:e.default.modalHeader,children:[(0,b.jsx)("h3",{children:"Add admin"}),(0,b.jsxs)("p",{className:e.default.modalSubtitle,children:["Account: ",w.account.name??`Account ${w.account.id}`]})]}),"form"===A?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:e.default.modalForm,children:(0,b.jsxs)("label",{className:e.default.modalLabel,children:["Admin email",(0,b.jsx)("input",{className:e.default.modalInput,type:"email",value:y,onChange:a=>z(a.target.value),placeholder:"admin@account.com"})]})}),(0,b.jsxs)("div",{className:e.default.modalActions,children:[(0,b.jsx)("button",{className:e.default.modalSecondary,type:"button",onClick:W,children:"Cancel"}),(0,b.jsx)("button",{className:e.default.modalPrimary,type:"button",onClick:X,children:"Add admin"})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:e.default.modalForm,children:[(0,b.jsx)("p",{className:e.default.panelBody,children:"Admin added. Save the temporary password below."}),(0,b.jsxs)("p",{className:e.default.panelBody,children:["Admin email: ",y.trim()]}),(0,b.jsx)("div",{className:e.default.passwordBox,children:C})]}),(0,b.jsx)("div",{className:e.default.modalActions,children:(0,b.jsx)("button",{className:e.default.modalPrimary,type:"button",onClick:W,children:"Done"})})]})]})})]})}a.s(["default",()=>h])}];

//# sourceMappingURL=src_app_accounts_page_tsx_817dd143._.js.map